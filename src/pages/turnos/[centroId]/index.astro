---
import { PublicBookingWizard } from '@/components/organismo/portal/PublicBookingWizard';
import db from '@/db';
import { centrosMedicos } from '@/db/schema';
import Layout from '@/layouts/Layout.astro';
import { eq } from 'drizzle-orm';

// Aqui cargaremos los datos del centro medico en el futuro
const { centroId } = Astro.params;

let centroMedico = null;
try {
  const queryCentro = await db.select().from(centrosMedicos).where(eq(centrosMedicos.id, centroId));
  if (queryCentro.length > 0) {
    centroMedico = queryCentro[0];
  }
  if (!centroMedico) {
    return Astro.redirect('/');
  }
  console.log(centroMedico);
} catch (error) {
  console.log(error);
}
---

<Layout>
  <div class="min-h-screen bg-gray-50 flex flex-col items-center py-10">
    <div class="w-full max-w-3xl bg-white rounded-xl shadow-lg p-6 md:p-10">
      {/* Header del Centro */}
      <header class="text-center mb-10 border-b pb-6">
        <h1 class="text-2xl font-bold capitalize text-gray-800">
          Centro Médico {centroMedico?.nombre}
        </h1>
        <p class="text-gray-500 mt-2">Reserva tu turno online de forma rápida y segura.</p>
      </header>

      {/* Contenido Principal con Wizard Interactivo */}
      <main class="w-full">
        <PublicBookingWizard client:only="react" centroMedicoId={centroId} />
      </main>

      <footer class="mt-10 text-center text-xs text-gray-400">
        <p>Sistema de Turnos &copy; {new Date().getFullYear()} ClinicalApp</p>
      </footer>
    </div>
  </div>
</Layout>
