---
import Button1 from '@/components/atomos/Button1.astro';
import DivBox1 from '@/components/atomos/DivBox1.astro';
import ModalEditarPerfil from '@/components/moleculas/ModalEditarPerfil.astro';
import FormularioPaciente from '@/pages/dashboard/pacientes/FormularioPaciente.astro';
import { generateId } from 'lucia';
import { PlusIcon, SaveIcon, UserCheck2Icon } from 'lucide-react';
import StatsPacienteHeader from './StatsPacienteHeader';

// Datos de ejemplo para el paciente
const patientData = {
  id: 'pat_' + generateId(10),
  nombre: 'Juan',
  apellido: 'PÃ©rez',
  dni: 12345678,
  email: 'juan.perez@ejemplo.com',
  fNacimiento: new Date('1990-01-15'),
  sexo: 'masculino',
  celular: '+54 9 11 1234-5678',
  grupoSanguineo: 'A+',
  domicilio: 'Av. Siempre Viva 123',
  provincia: 'Buenos Aires',
  ciudad: 'CABA',
  nObraSocial: '123456789',
  obraSocial: 'OSDE',
  estatura: 175,
  peso: 75,
  srcPhoto: '',
};

const { pacienteId } = Astro.params;
const { pacienteData } = Astro.props;
const ocupacion = 'Empleado';
const maritalStatus = 'Casado';
const { session } = Astro.locals;
const userId = session?.userId;

function calcularEdad(fechaNacimiento: Date): number {
  const hoy = new Date();
  const fechaNac = new Date(fechaNacimiento);
  let edad = hoy.getFullYear() - fechaNac.getFullYear();
  const mes = hoy.getMonth() - fechaNac.getMonth();
  if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
    edad--;
  }
  return edad;
}

const idAtencion = 'aten_' + generateId(10);
const edad = calcularEdad(patientData.fNacimiento);
---

<DivBox1>
  <!-- Resto del componente usando patientData -->
  <div class="flex w-full md:flex-row items-start md:items-center gap-6 p-6 h flex-1 flex-between">
    <UserCheck2Icon className="w-28 h-28 stroke-primary-textoTitle" />
    <!-- datps del paciente -->
    <StatsPacienteHeader pacienteData={patientData} client:load />
    <div class="flex flex-col gap-2 text-sm">
      <ModalEditarPerfil>
        <FormularioPaciente user paciente={patientData} />
      </ModalEditarPerfil>
      <Button1>
        <SaveIcon /> Exportar HC
      </Button1>
      <a
        href={`/api/atencion/nueva?pacienteId=${pacienteId}`}
        class="px-4 py-2 bg-primary text- border inline-flex items-center gap-2 border-primary-texto/20 cursor-pointer duration-150 bg-white rounded-md font-semibold hover:ring-1 hover:ring-primary-100 shadow-sm hover:shadow-md transition-shadow-md 0 transition-colors"
      >
        <PlusIcon /> Atender
      </a>
    </div>
  </div>
</DivBox1>
