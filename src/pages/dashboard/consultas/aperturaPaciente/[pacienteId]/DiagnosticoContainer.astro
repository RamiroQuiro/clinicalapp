---
import ContenedorAtencion from "../../../../../components/moleculas/ContenedorAtencion.astro";
import DiagnosticosContenedor from "../../../../../components/organismo/DiagnosticosContenedor";

const {isExistDiagnosticos}=Astro.props
---

<ContenedorAtencion
  labelH3="diagnostico"
  labelButton="guardar"
  idButton="guardarDiagnosticos"
>
  <DiagnosticosContenedor client:load  isExistDiagnosticos={isExistDiagnosticos}/>
</ContenedorAtencion>

<script>
    import { atencion } from "../../../../../context/store";
import { showToast } from "../../../../../utils/toast/toastShow";
  
    const btnEnviar = document.getElementById("guardarDiagnosticos");
  
    let dataDiagnostico={}
  
      
    atencion.subscribe((state) => { dataDiagnostico.diagnosticos=state.diagnosticos ,dataDiagnostico.dataIds=state.dataIds

    });

    btnEnviar.addEventListener("click", async (event) => {
      event.preventDefault(); // Evita el env√≠o del formulario por defecto
  
      try {
        if (dataDiagnostico.diagnosticos.length===0) {
            showToast('no hay diagnosticos para guardar', {
                background: 'bg-primary-400'
            })
            return
          }
        const response = await fetch("/api/pacientes/atencion/diagnostico", {
          method: "POST",
          body: JSON.stringify(dataDiagnostico), // No necesitas establecer manualmente "Content-Type"  voieriprg
        });
        const result = await response.json();
        console.log(result);
        document.location.reload()
      } catch (error) {
        console.error("Error al enviar el motivo de consulta:", error);
      }
    });
  </script>