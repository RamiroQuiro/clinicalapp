---
import MainDashboard from '@/components/atomos/MainDashboard.astro';
import ContenedorTitleBotonera from '../../../components/atomos/ContenedorTitleBotonera.astro';
import DivBox1 from '../../../components/atomos/DivBox1.astro';
import H2 from '../../../components/atomos/H2.astro';
import { getDashboardData } from '../../../services/dashboard.services';
import ContentedorStatsDash from './componente/ContentedorStatsDash';
import GraficoMotivosIniciales from './componente/GraficoMotivosIniciales.astro';
import GraficoUltimasAtenciones from './componente/GraficoUltimasAtenciones.astro';
import Header from './componente/Header.astro';
import ListaDeEspera from './componente/ListaDeEspera.astro';
import PacienteList from './componente/PacienteList.astro';
const { user, session } = Astro.locals;
let errorData = false;
const data = await getDashboardData(user?.id);
console.log('data dashboard', data);
---

<MainDashboard h1="Dashboard">
  <div class="py-4 gap-2 px-2 flex flex-col w-[97%]">
    <Header isClickend={true} />

    <div class="flex items-center gap-2 justify-evenly">
      <ContentedorStatsDash data={data?.stats} client:load />
    </div>

    <div class="flex items-start justify-between gap-2 w-full">
      <!-- ultimas atenciones -->
      <DivBox1 styleDiv="w-[30%]">
        <ContenedorTitleBotonera>
          <H2>Ultimas Atenciones</H2>
        </ContenedorTitleBotonera>
        <PacienteList
          ultimasAtenciones={data?.ultimasAtenciones}
          pacienteId={data?.ultimasAtenciones[0].pacienteId}
        />
      </DivBox1>

      <!-- lista de espera -->
      <ListaDeEspera />

      <!-- graficos -->
      <div class="flex flex-col gap-3 w-[40%] items-stretch justify-normal">
        <DivBox1 styleDiv="w12">
          <GraficoUltimasAtenciones data={data?.atencionesUlt7d} />
        </DivBox1>
        <DivBox1 styleDiv="w1/2">
          <GraficoMotivosIniciales data={data?.motivos} />
        </DivBox1>
      </div>
    </div>
  </div>
</MainDashboard>
