---
import MainDashboard from '@/components/atomos/MainDashboard.astro';
import Modal from '@/components/moleculas/Modal.astro';
import Section from '@/components/moleculas/Section';

import ConstendorStats from '@/components/organismo/agenda/ConstendorStats';
import ContenedorFormularioTurno from '@/components/organismo/agenda/ContenedorFormularioTurno';
import ContenedorSeleccionProfesionales from '@/components/organismo/agenda/ContenedorSeleccionProfesionales';
import { FormularioRapidoCargaPaciente } from '@/components/organismo/pacientes/FormularioRapidoCargaPaciente';
import { fetchDataProfesionalesEntidad } from '@/services/agenda.services';
import ContenedorAgenda from './ContenedorAgenda';
import ContenedorHorarios from './ContenedorHorarios';
import ContenedorTurnosDia from './ContenedorTurnosDia';
const { user } = Astro.locals;
// Solución temporal: Como solo hay un profesional, pasamos sus propios datos
const listaDeProfesionales = [
  {
    id: user.id,
    nombre: user.nombre,
    apellido: user.apellido,
  },
];

let dataProfesionales;
try {
  dataProfesionales = await fetchDataProfesionalesEntidad(user.id);
} catch (error) {
  console.log(error);
}
---

<MainDashboard h1="Agenda de Turnos">
  <div slot="botonera">
    <Modal id="modalNuevoTurno" title="Nuevo Turno">
      <ContenedorFormularioTurno client:load user={user} />
    </Modal>
    <Modal id="modalNuevoPaciente" title="Nuevo Paciente">
      <FormularioRapidoCargaPaciente client:load userId={user.id} />
    </Modal>

    <ContenedorSeleccionProfesionales
      client:load
      profesionales={dataProfesionales}
      centroMedicoId={user.centroMedicoId}
    />
  </div>
  <ConstendorStats client:load userId={user.id} />

  <div
    class="w-full flex gap-2 flex-wrap lg:flex-nowrap lg:items-start items-strecth justify-between h-full"
  >
    <!-- Columna 1: Calendario -->
    <Section title="Seleccionar Fecha" classContent="px- py-4 lg:w-1/4 w-full">
      <ContenedorAgenda
        client:load
        userId={user.id}
        centroMedicoId={user.centroMedicoId}
        rol={user.rolEnCentro}
      />
      <div class="flex justify-center mt-4 gap-4 flex-wrap">
        <div class="flex items-center gap-1">
          <div
            class="w-4 h-4 rounded"
            style={{ backgroundColor: '#bbf7d0', border: '1px solid #16a34a' }}
          >
          </div>
          <span class="text-xs">Disponible (0-9%)</span>
        </div>

        <div class="flex items-center gap-1">
          <div
            class="w-4 h-4 rounded"
            style={{ backgroundColor: '#fef08a', border: '1px solid #ca8a04' }}
          >
          </div>
          <span class="text-xs">Moderado (10-39%)</span>
        </div>
        <div class="flex items-center gap-1">
          <div
            class="w-4 h-4 rounded"
            style={{ backgroundColor: '#fed7aa', border: '1px solid #ea580c' }}
          >
          </div>
          <span class="text-xs">Ocupado (40-79%)</span>
        </div>
        <div class="flex items-center gap-1">
          <div
            class="w-4 h-4 rounded"
            style={{ backgroundColor: '#fecaca', border: '1px solid #dc2626' }}
          >
          </div>
          <span class="text-xs">Muy Ocupado (80-100%)</span>
        </div>
      </div>
    </Section>

    <!-- Columna 2: Turnos Agendados -->
    <Section title="Turnos del Día" classContent="px- py-4 md:w-[40vw]">
      <ContenedorTurnosDia client:load user={user} />
    </Section>

    <!-- Columna 3: Horarios Disponibles -->
    <Section title="Horarios Disponibles" classContent="px- py-4 md:w-[30vw]">
      <ContenedorHorarios client:load />
    </Section>
  </div>
</MainDashboard>
