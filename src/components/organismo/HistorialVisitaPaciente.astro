---
import { Calendar, Newspaper, User } from 'lucide-react';
import formatDate from '../../utils/formatDate';
import Button1 from '../atomos/Button1.astro';
import ContenedorTitleBotonera from '../atomos/ContenedorTitleBotonera.astro';
import DivBox1 from '../atomos/DivBox1.astro';

interface Visitas {
  fecha: string;
  motivo: string;
  doctor?: string;
  department?: string;
  tratamiento?: string;
  diagnosticos?: string;
}

interface RecentVisitsProps {
  visitas: Visitas[];
}

const { visitas, colorMap } = Astro.props as RecentVisitsProps;
const { pacienteId } = Astro.params;
---

<DivBox1>
  <ContenedorTitleBotonera>
    <h2 class="text-lg font-semibold">Visitas Recientes</h2>
    <div>
      <Button1>ver historial</Button1>
    </div>
  </ContenedorTitleBotonera>

  <div class="grid gap-4 w-full">
    {
      visitas?.map(visit => (
        <div
          style={{
            '--card-bg': colorMap[visit.id] || '#f8fafc',
            '--card-border': colorMap[visit.id] ? `${colorMap[visit.id]}80` : '#e2e8f0',
          }}
          class="group relative overflow-hidden duration-300 bg-primary-bg-componentes rounded-xl border hover:border-primary-100/50"
        >
          <details class="p-4 open:bg-primary-bg-claro/5 backdrop-blur-sm open:rounded-lg open:border-primary-100/50 open:border cursor-pointer">
            {/* Header */}
            <summary class="flex items-start justify-between">
              <div class="flex-1 min-w-0 space-y-3 flex flex-col">
                <div class="flex items-center gap-2">
                  <div class="flex items-center gap-2  text-primary-100 border border-primary-100 font-medium bg-primary-100/10 px-2 py-1 rounded-full">
                    <Calendar size={16} />
                    <p class="text-sm ">Fecha:</p>
                    <p class="text-sm">{formatDate(visit.fecha)}</p>
                  </div>
                  <div class="flex items-center gap-2 rounded-full m-auto justify-center capitalize   font-medium bg-white/50">
                    <User size={20} className="" />
                    <p class="text-sm ">Atendido por:</p>{' '}
                    <h2 class="text-lg  text-primary-textoTitle">{visit.profesional}</h2>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <Newspaper size={16} />
                  <p class="text-sm ">Motivo Inicial:</p>
                  <h3 class="text-base font-medium text-primary-textoTitle truncate">
                    {visit.motivoInicial}
                  </h3>
                </div>
              </div>
            </summary>

            {/* Details (initially hidden) */}
            <div class="mt-3 space-y-2 text-sm">
              <div>
                <p class="text-primary-texto trun">{visit.motivoConsulta}</p>
              </div>
            </div>

            {/* Action Button */}
            <div class="mt-4 flex justify-end">
              <a
                href={`/dashboard/consultas/aperturaPaciente/${pacienteId}/${visit.id}`}
                class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-full text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"
              >
                Ver detalles
                <svg class="ml-1 h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </a>
            </div>
          </details>

          {/* Decorative elements */}
        </div>
      ))
    }
  </div>
</DivBox1>
