---
import { Calendar, Newspaper, User } from 'lucide-react';
import formatDate from '../../utils/formatDate';
import Button1 from '../atomos/Button1.astro';
import ContenedorTitleBotonera from '../atomos/ContenedorTitleBotonera.astro';
import DivBox1 from '../atomos/DivBox1.astro';

interface Visitas {
  fecha: string;
  motivo: string;
  doctor?: string;
  department?: string;
  tratamiento?: string;
  diagnosticos?: string;
}

interface RecentVisitsProps {
  visitas: Visitas[];
}

const { visitas, colorMap } = Astro.props as RecentVisitsProps;
console.log('visitas ihstoriacs', visitas);
const cabeceraColumn = [
  {
    id: 1,
    label: 'fecha',
  },
  {
    id: 2,
    label: 'motivo',
  },
  {
    id: 3,
    label: 'profesional',
  },
];
---

<DivBox1>
  <ContenedorTitleBotonera>
    <h2 class="text-lg font-semibold">Visitas Recientes</h2>
    <div>
      <Button1>ver historial</Button1>
    </div>
  </ContenedorTitleBotonera>

  <div class="grid gap-4 w-full">
    {
      visitas?.map(visit => (
        <div
          style={{
            '--card-bg': colorMap[visit.id] || '#f8fafc',
            '--card-border': colorMap[visit.id] ? `${colorMap[visit.id]}80` : '#e2e8f0',
          }}
          class="group relative overflow-hidden duration-300 bg-primary-bg-componentes rounded-xl border hover:border-primary-100/50"
        >
          <details class="p-4">
            {/* Header */}
            <summary class="flex items-start justify-between">
              <div class="flex-1 min-w-0 space-y-3">
                <div class="flex items-center gap-2">
                  <Calendar size={16} />
                  <p class="text-xs text-primary-100 border border-primary-100 font-medium bg-primary-100/10 px-2 py-1 rounded-full">
                    {formatDate(visit.fecha)}
                  </p>
                </div>
                <div class="flex items-center gap-2">
                  <Newspaper size={16} />
                  <h3 class="text-sm font-medium text-primary-textoTitle truncate">
                    {visit.motivoInicial}
                  </h3>
                </div>
              </div>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-lg capitalize  justify-center font-medium bg-white/50 text-primary-textoTitle">
                <User size={20} className="mr-2" />
                <span class="mr-2 text-sm ">atendido por:</span> {visit.profesional}
              </span>
            </summary>

            {/* Details (initially hidden) */}
            <div class="mt-3 space-y-2 text-sm">
              <div>
                <p class="text-primary-texto trun">{visit.motivoConsulta}</p>
              </div>
            </div>

            {/* Action Button */}
            <div class="mt-4 flex justify-end">
              <a
                href={`/dashboard/consultas/${visit.id}`}
                class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-full text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"
              >
                Ver detalles
                <svg class="ml-1 h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </a>
            </div>
          </details>

          {/* Decorative elements */}
        </div>
      ))
    }
  </div>
</DivBox1>
