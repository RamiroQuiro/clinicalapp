---
// src/components/organismo/NavAtencionMedicaV2.astro
import { Image } from 'astro:assets';
import avatarDefault from '/public/avatarDefault.png';
import ContenedorBotonesFinalizrConsulta from '@/pages/dashboard/consultas/aperturaPaciente/[pacienteId]/componenteAtencionV2/ContenedorBotonesFinalizrConsulta.tsx';
import DivBox1 from '../atomos/DivBox1.astro';
const { pacienteId, atencionId } = Astro.params;
const { pacienteData, esFinalizada } = Astro.props;
const { nombre, apellido, dni, fotoUrl } = pacienteData;
---

{/* Usamos un bloque condicional de Astro para renderizar un header u otro */}
{esFinalizada ? (
  // HEADER PARA CONSULTA FINALIZADA (NUEVO DISEÑO)
  <DivBox1
    variant="default"
    rounded="lg"
    shadow="md"
    className="bg-gradient-to-r from-indigo-950 to-slate-900 shadow-sm rounded-b-lg sticky top-0 z-10 border-b border-x p-2 border-slate-700"
  >
    <div class="flex items-center justify-between gap-4 h- w-full">
      <!-- Datos del Paciente (Izquierda) -->
      <div class="flex items-center gap-4 flex-shrink-0">
        <Image
          src={fotoUrl || avatarDefault}
          alt="Foto de perfil"
          class="h-16 w-16 rounded-full object-cover hidden md:block border-2 border-slate-600"
          width={40}
          height={40}
        />
        <div>
          <h1 class="text-2xl capitalize font-semibold text-white">{nombre} {apellido}</h1>
          <p class="text-lg text-gray-300">DNI: {dni}</p>
        </div>
      </div>

      <!-- Sello de Estado (Centro) -->
      <div class="flex-grow flex items-center justify-center">
        <div class="px-4 py-1 bg-slate-700/50 text-sky-300 rounded-full text-sm font-semibold border border-sky-400/30">
          CONSULTA FINALIZADA
        </div>
      </div>

      <!-- Botones de Acción (Derecha) -->
      <div class="flex md:flex-col flex-row w-full md:w-fit items-center gap-2 flex-shrink-0">
        <ContenedorBotonesFinalizrConsulta
          client:load
          pacienteId={pacienteId || ''}
          atencionId={atencionId || ''}
          esFinalizada={esFinalizada}
        />
      </div>
    </div>
  </DivBox1>
) : (
  // HEADER PARA CONSULTA EN CURSO (DISEÑO ORIGINAL)
  <DivBox1
    id="navAtencionMedica"
    variant="default"
    rounded="lg"
    shadow="md"
    className="bg-white/70 backdrop-blur-sm shadow-sm rounded-b-lg sticky top-0 z-10 border-b border-x p-2 border-gray-200"
  >
    <div class="flex md:items-center flex-col md:flex-row justify-between gap-2 h- w-full">
      <!-- Datos del Paciente -->
      <div class="flex items-center gap-4">
        <Image
          src={fotoUrl || avatarDefault}
          alt="Foto de perfil"
          class="h-16 w-16 rounded-full object-cover hidden md:block"
          width={40}
          height={40}
        />
        <div>
          <h1 class="text-2xl capitalize font-semibold text-gray-800">{nombre} {apellido}</h1>
          <p class="text-lg text-gray-500">DNI: {dni}</p>
        </div>
      </div>
      {/* Datos detallados solo para consulta en curso */}
      <div class="hidden md:flex border- px-3 w-fit flex-1 md:items-center text-sm h-full font- justify-evenly flex-wrap gap-4">
          <div class="flex items-start capitalize text-sm flex-col">
            <p>Sexo:</p>
            <span class="font-normal text-primary-textoTitle text-base">{pacienteData.sexo}</span>
          </div>
          <div class="flex items-start capitalize text-sm flex-col">
            <p>Celular:</p>
            <span class="font-normal text-primary-textoTitle text-base">{pacienteData.celular}</span>
          </div>
          <div class="flex items-start capitalize text-sm flex-col">
            <p>Email:</p>
            <span class="font-normal text-primary-textoTitle text-base">{pacienteData.email}</span>
          </div>
          <div class="flex items-start capitalize text-sm flex-col">
            <p>Obra Social:</p>
            <span class="font-normal text-primary-textoTitle text-base">{pacienteData.obraSocial}</span>
          </div>
          <div class="flex items-start capitalize text-sm flex-col">
            <p>Fecha de Nacimiento:</p>
            <span class="font-normal text-primary-textoTitle text-base">{pacienteData.fNacimiento.toLocaleDateString()}</span>
          </div>
          <div class="flex items-start capitalize text-sm flex-col">
            <p>Domicilio:</p>
            <span class="font-normal text-primary-textoTitle text-base">{pacienteData.domicilio}</span>
          </div>
        </div>
      <!-- Botones de Acción -->
      <div class="flex md:flex-col flex-row w-full md:w-fit items-center gap-2">
        <ContenedorBotonesFinalizrConsulta
          client:load
          pacienteId={pacienteId || ''}
          atencionId={atencionId || ''}
          esFinalizada={esFinalizada}
        />
      </div>
    </div>
  </DivBox1>
)}

<script>
  // La lógica de eventos se mantiene, pero podría ser refactorizada en el futuro
  // para vivir dentro de los componentes de React si fuera necesario.
  const botonFinalizar = document.getElementById('finalizarConsultaV2');
  const botonGuardar = document.getElementById('guardarBorradorV2');

  botonGuardar?.addEventListener('click', () => {
    const event = new CustomEvent('guardar-borrador-v2');
    window.dispatchEvent(event);
  });

  botonFinalizar?.addEventListener('click', () => {
    const event = new CustomEvent('finalizar-consulta-v2');
    window.dispatchEvent(event);
  });
</script>