---
import {
  BarChart3,
  CalendarDays,
  ClipboardCheck,
  CreditCard,
  Home,
  PanelLeftClose,
  PanelLeftOpen,
  Settings,
  Users,
} from 'lucide-react';

// 1Ô∏è‚É£ Obtenemos los datos del usuario y ruta actual
const { user } = Astro.locals;
const { pathname } = Astro.url;
const currentPath = pathname;

// 2Ô∏è‚É£ Definimos secciones con los roles permitidos
const sections = [
  {
    name: 'Dashboard',
    href: '/dashboard',
    icon: Home,
    rolesPermitidos: ['adminLocal', 'profesional'],
  },
  {
    name: 'Agenda',
    href: '/dashboard/agenda',
    icon: CalendarDays,
    rolesPermitidos: ['adminLocal', 'profesional'],
  },
  {
    name: 'Recepci√≥n',
    href: '/dashboard/recepcion',
    icon: ClipboardCheck,
    rolesPermitidos: ['recepcion', 'adminLocal', 'profesional'],
  },
  {
    name: 'Pacientes',
    href: '/dashboard/pacientes',
    icon: Users,
    rolesPermitidos: ['profesional', 'adminLocal'],
  },
  {
    name: 'Facturaci√≥n',
    href: '/dashboard/facturacion',
    icon: CreditCard,
    rolesPermitidos: ['adminLocal'],
  },
  {
    name: 'Reportes',
    href: '/dashboard/reportes',
    icon: BarChart3,
    rolesPermitidos: ['adminLocal'],
  },
  {
    name: 'Configuraci√≥n',
    href: '/dashboard/ajustes',
    icon: Settings,
    rolesPermitidos: ['adminLocal', 'profesional'],
  },
];
---

<aside
  id="aside"
  class="group/sidebar w-full fixed bottom-0 left-0 h- z-20 md:flex md:flex-col items-center justify-start py-1.5 md:py-4 md:h-screen md:sticky md:top-0 md:self-start md:w-16 md:border-r md:border-none border-t bg-gradient-to-b from-primary-100 to-primary-150 backdrop-blur-sm md:backdrop-blur-none text-primary-textoTitle transition-all duration-300 ease-in-out"
>
  <div class="w-full hidden md:flex px-4 mx-auto items-center justify-end">
    <PanelLeftOpen
      id="openMenu"
      size={35}
      className="cursor-pointer stroke-white hover:bg-primary-200 p-1 rounded-full duration-300"
    />
    <PanelLeftClose
      id="closeMenu"
      size={35}
      className="cursor-pointer hidden stroke-white hover:bg-primary-200 p-1 rounded-full duration-300"
    />
  </div>

  <!-- Logo -->
  <div id="logo" class="items-center justify-center h-20 hidden">
    <a href="/dashboard" class="transition-transform duration-300 group-hover:scale-110">
      <img src="/ramaCodeBlanco.png" alt="Logo Completo" class="w-24 h-24 -aparecer" />
    </a>
  </div>

  <!-- Men√∫ lateral -->
  <nav
    class="flex-1 flex md:flex-col w-full duration-300 px-1 md:px-3 items-center md:justify-start justify-evenly md:items-start md:mt-10 -aparecer space-y-2"
  >
    {
      sections
        // üîπ Filtrar seg√∫n los roles permitidos
        .filter(section => section.rolesPermitidos.includes(user.rolEnCentro))
        .map(section => {
          const isActive =
            currentPath === section.href ||
            (section.href !== '/dashboard' && currentPath.startsWith(section.href));

          return (
            <a
              href={section.href}
              class:list={[
                'flex items-center w-fit md:w-full group/item z-50 p-2 md:px-2.5 md:py-2.5 text-sm font-medium rounded-lg transition-colors',
                {
                  'bg-gray-100 text-primary-100': isActive,
                  'text-white hover:bg-gray-100 hover:text-primary-100': !isActive,
                },
              ]}
            >
              <section.icon className="md:h-5 md:w-5 h-5 w-5 md:flex-shrink-0" />
              <span class="menu-text-inline hidden group-[.is-open]/sidebar:inline ml-3 whitespace-nowrap">
                {section.name}
              </span>
              <span class="menu-text-tooltip absolute left-full duration-300 ml-1 hidden group-hover/item:block group-[.is-open]/sidebar:hidden rounded-lg px-2 py-1 text-sm bg-primary-100/90 backdrop-blur-sm text-white z-[999]">
                {section.name}
              </span>
            </a>
          );
        })
    }
  </nav>

  <!-- Footer -->
  <div class="px-2 py-4 border-t w-full hidden md:block border-gray-200">
    <div class="flex items-center w-full justify-center group-hover:justify-start group-hover:px-2">
      <img
        class="h-10 w-10 rounded-full object-contain flex-shrink-0"
        src="/ramaCodeBlanco.png"
        alt="Avatar"
      />
      <div class="ml-3 hidden group animate-aparecer divide-purple-300" id="spanRamacode">
        <p class="text-sm font-medium text-primary-texto whitespace-nowrap">RamaCode</p>
        <p class="text-xs text-primary-texto whitespace-nowrap">www.ramacode.com</p>
      </div>
    </div>
  </div>
</aside>
