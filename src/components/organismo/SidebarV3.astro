---
import {
  BarChart3,
  CalendarDays,
  ClipboardCheck,
  CreditCard,
  Home,
  PanelLeftClose,
  PanelLeftOpen,
  Settings,
  Users,
} from 'lucide-react';

// 1Ô∏è‚É£ Obtenemos los datos del usuario y ruta actual
const { user } = Astro.locals;
const { pathname } = Astro.url;
const currentPath = pathname;

// 2Ô∏è‚É£ Definimos secciones con los roles permitidos
const sections = [
  {
    name: 'Dashboard',
    href: '/dashboard',
    icon: Home,
    rolesPermitidos: ['adminLocal', 'profesional'],
  },
  {
    name: 'Agenda',
    href: '/dashboard/agenda',
    icon: CalendarDays,
    rolesPermitidos: ['adminLocal', 'profesional'],
  },
  {
    name: 'Recepci√≥n',
    href: '/dashboard/recepcion',
    icon: ClipboardCheck,
    rolesPermitidos: ['recepcion', 'adminLocal', 'profesional'],
  },
  {
    name: 'Pacientes',
    href: '/dashboard/pacientes',
    icon: Users,
    rolesPermitidos: ['profesional', 'adminLocal'],
  },
  {
    name: 'Facturaci√≥n',
    href: '/dashboard/facturacion',
    icon: CreditCard,
    rolesPermitidos: ['adminLocal'],
  },
  {
    name: 'Reportes',
    href: '/dashboard/reportes',
    icon: BarChart3,
    rolesPermitidos: ['adminLocal'],
  },
  {
    name: 'Configuraci√≥n',
    href: '/dashboard/ajustes',
    icon: Settings,
    rolesPermitidos: ['adminLocal', 'profesional'],
  },
];
---

<aside
  id="aside"
  class="group/sidebar md:top-0 bottom-0 left-0 z-20 fixed md:sticky md:flex md:flex-col justify-start items-center md:self-start bg-white lg:bg-gradient-to-b from-primary-100 lg:to-primary-150/90 backdrop-blur-sm md:backdrop-blur-none py-1.5 md:py-4 border-primary-100 border-t border-t md:border-r md:border-none w-full md:w-16 h- md:h-screen text-primary-textoTitle transition-all duration-300 ease-in-out"
>
  <div class="hidden md:flex justify-end items-center mx-auto px-4 w-full">
    <PanelLeftOpen
      id="openMenu"
      size={35}
      className="hover:bg-primary-200 stroke-white p-1 rounded-full duration-300 cursor-pointer"
    />
    <PanelLeftClose
      id="closeMenu"
      size={35}
      className="hidden hover:bg-primary-200 stroke-white p-1 rounded-full duration-300 cursor-pointer"
    />
  </div>

  <!-- Logo -->
  <div id="logo" class="hidden justify-center items-center h-20">
    <a href="/dashboard" class="group-hover:scale-110 transition-transform duration-300">
      <img src="/ramaCodeBlanco.png" alt="Logo Completo" class="w-24 h-24 -aparecer" />
    </a>
  </div>

  <!-- Men√∫ lateral -->
  <nav
    class="flex md:flex-col flex-1 justify-evenly md:justify-start items-center md:items-start space-y-2 md:mt-10 px-1 md:px-3 w-full duration-300 -aparecer"
  >
    {
      sections
        // üîπ Filtrar seg√∫n los roles permitidos
        .filter(section => section.rolesPermitidos.includes(user?.rolEnCentro))
        .map(section => {
          const isActive =
            currentPath === section.href ||
            (section.href !== '/dashboard' && currentPath.startsWith(section.href));

          return (
            <a
              href={section.href}
              class:list={[
                'flex items-center w-fit md:w-full group/item z-50 p-2 lg:px-2.5 lg:py-2.5 text-sm font-medium rounded-lg transition-colors',
                {
                  'bg-gray-100 text-primary-100': isActive,
                  'lg:text-white hover:bg-gray-100 hover:text-primary-100': !isActive,
                },
              ]}
            >
              <section.icon className="lg:flex-shrink-0 w-5 lg:w-5 h-5 lg:h-5" />
              <span class="hidden menu-text-inline group-[.is-open]/sidebar:inline ml-3 whitespace-nowrap">
                {section.name}
              </span>
              <span class="hidden group-[.is-open]/sidebar:hidden group-hover/item:block left-full z-[999] absolute bg-primary-100/90 backdrop-blur-sm ml-1 px-2 py-1 rounded-lg menu-text-tooltip text-white text-sm duration-300">
                {section.name}
              </span>
            </a>
          );
        })
    }
  </nav>

  <!-- Footer -->
  <div class="hidden md:block px-2 py-4 border-gray-200 border-t w-full">
    <div class="flex justify-center group-hover:justify-start items-center group-hover:px-2 w-full">
      <img
        class="flex-shrink-0 rounded-full w-10 h-10 object-contain"
        src="/ramaCodeBlanco.png"
        alt="Avatar"
      />
      <div class="group hidden ml-3 divide-purple-300 animate-aparecer" id="spanRamacode">
        <p class="font-medium text-primary-texto text-sm whitespace-nowrap">RamaCode</p>
        <p class="text-primary-texto text-xs whitespace-nowrap">www.ramacode.com</p>
      </div>
    </div>
  </div>
</aside>
