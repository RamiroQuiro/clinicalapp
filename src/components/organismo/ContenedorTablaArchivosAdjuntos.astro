---
import { Download, Edit3, Eye } from 'lucide-react';
import type { Documentos } from '../../types';
import formatDate from '../../utils/formatDate';
import BotonIndigo from '../moleculas/BotonIndigo.astro';
import Modal from '../moleculas/Modal.astro';
import FormularioArchivosAdjuntos from './FormularioArchivosAdjuntos';

const { documentos } = Astro.props as Documentos;

const getTypeIcon = (tipo: Documentos['tipo']) => {
  switch (tipo) {
    case 'laboratorios':
      return 'üß™';
    case 'rayosx':
      return 'üì∑';
    case 'prescripcion':
      return 'üìù';
    case 'derivacion':
      return 'üìù';
    case 'electrocardiograma':
      return '‚ù§Ô∏è';
    default:
      return 'üìÑ';
  }
};
const getStatusColor = (status: Documentos['estado']) => {
  switch (status) {
    case 'pendiente':
      return 'bg-yellow-100 text-yellow-800';
    case 'revisar':
      return 'bg-green-100 text-green-800';
    case 'archivado':
      return 'bg-gray-100 text-gray-800';
    default:
      return 'bg-gray-100 text-gray-800';
  }
};
---

<table class="w-full">
  <thead>
    <tr class="text-left border-b">
      <th class="pb-3 text-sm font-medium text-muted-foreground">Documento</th>
      <th class="pb-3 text-sm font-medium text-muted-foreground">Fecha</th>
      <th class="pb-3 text-sm font-medium text-muted-foreground">Tama√±o</th>
      <th class="pb-3 text-sm font-medium text-muted-foreground">Estado</th>
      <th class="pb-3 text-sm font-medium text-muted-foreground">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {
      documentos?.slice(0, 5)?.map((doc, index) => {
        const dateFormat = formatDate(doc.created_at);
        return (
          <tr class="border-b last:border-0">
            <td class="py-4">
              <div class="flex items-center gap-2">
                <span class="text-xl">{getTypeIcon(doc.tipo)}</span>
                <div>
                  <p class="font-medium text-sm">{doc.nombre}</p>
                </div>
              </div>
            </td>
            <td class="py-4 text-sm">{dateFormat}</td>
            <td class="py-4 text-sm">{doc.tama√±o}</td>
            <td class="py-4">
              <span
                class={`px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(doc.estado)}`}
              >
                {doc.estado.charAt(0).toUpperCase() + doc.estado.slice(1)}
              </span>
            </td>
            <td class="py-4 flex items-center gap-2">
              <Modal title="Editar Documento" id="modal-editar" isIcon={true}>
                <BotonIndigo slot="icon" id="modal-open-modal-editar">
                  <Edit3 size={16} />
                </BotonIndigo>
                <FormularioArchivosAdjuntos client:load pacienteId={doc.pacienteId} doc={doc} />
              </Modal>
              <BotonIndigo>
                <a
                  href={`/api/documentos/serve/${doc.id}`}
                  target="_blank"
                  class="flex items-center gap-1"
                  rel="noopener noreferrer"
                >
                  <Eye size={16} />/<Download size={16} />
                </a>
              </BotonIndigo>
            </td>
          </tr>
        );
      })
    }
  </tbody>
</table>
